{% extends 'base.html' %}
{% load static %}
{% block content %}
    <div class="slider-with-banner">
        <div class="container">
            <div class="row">
                <!-- Begin Slider Area -->
                <div class="col-lg-8 col-md-8">
                    <div class="slider-area">
                        <div class="slider-active owl-carousel">
                            <div class="single-slide align-center-left  animation-style-01 bg-1">
                                <div class="slider-progress"></div>
                                <div class="slider-content">
                                    <h5>Sale Offer <span>-20% Off</span> This Week</h5>
                                    <h2>Chamcham Galaxy S9 | S9+</h2>
                                    <h3>Starting at <span>$1209.00</span></h3>
                                    <div class="default-btn slide-btn">
                                        <a class="links" href="{% url 'shop:shop' %}">Shopping Now</a>
                                    </div>
                                </div>
                            </div>
                            <div class="single-slide align-center-left animation-style-02 bg-2">
                                <div class="slider-progress"></div>
                                <div class="slider-content">
                                    <h5>Sale Offer <span>Black Friday</span> This Week</h5>
                                    <h2>Work Desk Surface Studio 2018</h2>
                                    <h3>Starting at <span>$824.00</span></h3>
                                    <div class="default-btn slide-btn">
                                        <a class="links" href="{% url 'shop:shop' %}">Shopping Now</a>
                                    </div>
                                </div>
                            </div>
                            <div class="single-slide align-center-left animation-style-01 bg-3">
                                <div class="slider-progress"></div>
                                <div class="slider-content">
                                    <h5>Sale Offer <span>-10% Off</span> This Week</h5>
                                    <h2>Phantom 4 Pro+ Obsidian</h2>
                                    <h3>Starting at <span>$1849.00</span></h3>
                                    <div class="default-btn slide-btn">
                                        <a class="links" href="{% url 'shop:shop' %}">Shopping Now</a>
                                    </div>
                                </div>
                            </div>
                            <!-- Single Slide Area End Here -->
                        </div>
                    </div>
                </div>
                <!-- Slider Area End Here -->
                <!-- Begin Li Banner Area -->
                <div class="col-lg-4 col-md-4 text-center pt-xs-30">
                    <div class="li-banner">
                        <a href="#">
                            <img src="{% static 'images/banner/1_1.jpg' %}" alt="">
                        </a>
                    </div>
                    <div class="li-banner mt-15 mt-sm-30 mt-xs-30">
                        <a href="#">
                            <img src="{% static 'images/banner/1_2.jpg' %}" alt="">
                        </a>
                    </div>
                </div>
                <!-- Li Banner Area End Here -->
            </div>
        </div>
    </div>
    <!-- Slider With Banner Area End Here -->
    <!-- Begin Product Area -->
    <div class="product-area pt-60 pb-50">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="li-product-tab">
                        <ul class="nav li-product-menu">
                            <li><a class="active" data-toggle="tab" href="#li-new-product"><span>New Arrival</span></a></li>
                            <li><a data-toggle="tab" href="#li-bestseller-product"><span>Premium</span></a></li>
                            <li><a data-toggle="tab" href="#li-featured-product"><span>Cheapest</span></a></li>
                        </ul>
                    </div>
                    <!-- Begin Li's Tab Menu Content Area -->
                </div>
            </div>
            <div class="tab-content">
                <div id="li-new-product" class="tab-pane active show" role="tabpanel">
                    <div class="row">
                        <div class="product-active owl-carousel">
                            {% for product in new_arrivals %}
                                <div class="col-lg-12">
                                <!-- single-product-wrap start -->
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="{% url 'shop:shop_single_product_detail' product.id %}">
                                            <img src="{{ product.images.first.image.url }}"
                                                 alt="Li's Product Image">
                                        </a>
                                        <span class="sticker">New</span>
                                    </div>
                                    <div class="product_desc">
                                        <div class="product_desc_info">
                                            <div class="product-review">
                                                <h5 class="manufacturer">
                                                    <a href="{% url 'shop:shop' %}">Graphic Corner</a>
                                                </h5>
                                                <div class="rating-box">
                                                    <ul class="rating">
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <h4><a class="product_name"
                                                   href="{% url 'shop:shop_single_product_detail' product.id %}">{{ product.title }}</a></h4>
                                            <div class="price-box">
                                                <span class="new-price">{{ product.price }}</span>
                                            </div>
                                        </div>
                                        <div class="add-actions">
                                            <ul class="add-actions-link">
<li class="add-cart active" >
    <a href="#" class="add-to-cart" data-product-id="{{ product.id }}  " onclick="setTimeout(() => { window.location.reload(); }, 500);">
        Add to cart
    </a>
</li>                                                <li class="wishlist">
                                                    <a href="#" class="add-wishlist" data-product-id="{{ product.id }}">
                                                        <i class="fa fa-heart-o"></i>
                                                    </a>
                                                </li>
                                                <li><a href="#" title="quick view" class="quick-view-btn"
                                                       data-toggle="modal" data-target="#exampleModalCenter"><i
                                                        class="fa fa-eye"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <!-- single-product-wrap end -->
                            </div>
                            {% endfor %}

                        </div>
                    </div>
                </div>
                <div id="li-bestseller-product" class="tab-pane" role="tabpanel">
                    <div class="row">
                        <div class="product-active owl-carousel">
                            {% for product in premium %}
                            <div class="col-lg-12">
                                <!-- single-product-wrap start -->
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="{% url 'shop:shop_single_product_detail' product.id %}">
                                            <img src="{{ product.images.first.image.url }}"
                                                 alt="Li's Product Image">
                                        </a>
                                        <span class="sticker">New</span>
                                    </div>
                                    <div class="product_desc">
                                        <div class="product_desc_info">
                                            <div class="product-review">
                                                <h5 class="manufacturer">
                                                    <a href="{% url 'shop:shop' %}">Graphic Corner</a>
                                                </h5>
                                                <div class="rating-box">
                                                    <ul class="rating">
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <h4><a class="product_name"
                                                   href="{% url 'shop:shop_single_product_detail' product.id %}">{{ product.title }}</a></h4>
                                            <div class="price-box">
                                                <span class="new-price">${{ product.price }}</span>
                                            </div>
                                        </div>
                                        <div class="add-actions">
                                            <ul class="add-actions-link">
<li class="add-cart active" >
    <a href="#" class="add-to-cart" data-product-id="{{ product.id }}  " onclick="setTimeout(() => { window.location.reload(); }, 500);">
        Add to cart
    </a>
</li>                                                <li class="wishlist">
                                                    <a href="#" class="add-wishlist" data-product-id="{{ product.id }}">
                                                        <i class="fa fa-heart-o"></i>
                                                    </a>
                                                </li>
                                                <li><a href="#" title="quick view" class="quick-view-btn"
                                                       data-toggle="modal" data-target="#exampleModalCenter"><i
                                                        class="fa fa-eye"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <!-- single-product-wrap end -->
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div id="li-featured-product" class="tab-pane" role="tabpanel">
                    <div class="row">
                        <div class="product-active owl-carousel">
                            {% for product in cheapest %}
                            <div class="col-lg-12">
                                <!-- single-product-wrap start -->
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="{% url 'shop:shop_single_product_detail' product.id %}">
                                            <img src="{{ product.images.first.image.url }}"
                                                 alt="Li's Product Image">
                                        </a>
                                        <span class="sticker">New</span>
                                    </div>
                                    <div class="product_desc">
                                        <div class="product_desc_info">
                                            <div class="product-review">
                                                <h5 class="manufacturer">
                                                    <a href="{% url 'shop:shop' %}">Graphic Corner</a>
                                                </h5>
                                                <div class="rating-box">
                                                    <ul class="rating">
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <h4><a class="product_name"
                                                   href="{% url 'shop:shop_single_product_detail' product.id %}">{{ product.title }}</a></h4>
                                            <div class="price-box">
                                                <span class="new-price">${{ product.price }}</span>
                                            </div>
                                        </div>
                                        <div class="add-actions">
                                            <ul class="add-actions-link">
<li class="add-cart active" >
    <a href="#" class="add-to-cart" data-product-id="{{ product.id }}  " onclick="setTimeout(() => { window.location.reload(); }, 500);">
        Add to cart
    </a>
</li>                                                <li class="wishlist">
                                                    <a href="#" class="add-wishlist" data-product-id="{{ product.id }}">
                                                        <i class="fa fa-heart-o"></i>
                                                    </a>
                                                </li>
                                                <li><a href="#" title="quick view" class="quick-view-btn"
                                                       data-toggle="modal" data-target="#exampleModalCenter"><i
                                                        class="fa fa-eye"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <!-- single-product-wrap end -->
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Product Area End Here -->
    <!-- Begin Li's Static Banner Area -->
    <div class="li-static-banner">
        <div class="container">
            <div class="row">
                <!-- Begin Single Banner Area -->
                <div class="col-lg-4 col-md-4 text-center">
                    <div class="single-banner">
                        <a href="#">
                            <img src="{% static 'images/banner/1_3.jpg' %}" alt="Li's Static Banner">
                        </a>
                    </div>
                </div>
                <!-- Single Banner Area End Here -->
                <!-- Begin Single Banner Area -->
                <div class="col-lg-4 col-md-4 text-center pt-xs-30">
                    <div class="single-banner">
                        <a href="#">
                            <img src="{% static 'images/banner/1_4.jpg' %}" alt="Li's Static Banner">
                        </a>
                    </div>
                </div>
                <!-- Single Banner Area End Here -->
                <!-- Begin Single Banner Area -->
                <div class="col-lg-4 col-md-4 text-center pt-xs-30">
                    <div class="single-banner">
                        <a href="#">
                            <img src="{% static 'images/banner/1_5.jpg' %}" alt="Li's Static Banner">
                        </a>
                    </div>
                </div>
                <!-- Single Banner Area End Here -->
            </div>
        </div>
    </div>
    <!-- Li's Static Banner Area End Here -->
    <!-- Begin Li's Laptop Product Area -->
    <section class="product-area li-laptop-product pt-60 pb-45">
        <div class="container">
            <div class="row">
                <!-- Begin Li's Section Area -->
                <div class="col-lg-12">
                    <div class="li-section-title">
                        <h2>
                            <span>Laptop</span>
                        </h2>
                    </div>
                    <div class="row">
                        <div class="product-active owl-carousel">
                            {% for product in laptops %}
                            <div class="col-lg-12">
                                <!-- single-product-wrap start -->
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="{% url 'shop:shop_single_product_detail' product.id %}">
                                            <img src="{{ product.images.first.image.url }}"
                                                 alt="Li's Product Image">
                                        </a>
                                        <span class="sticker">New</span>
                                    </div>
                                    <div class="product_desc">
                                        <div class="product_desc_info">
                                            <div class="product-review">
                                                <h5 class="manufacturer">
                                                    <a href="{% url 'shop:shop' %}">Graphic Corner</a>
                                                </h5>
                                                <div class="rating-box">
                                                    <ul class="rating">
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <h4><a class="product_name"
                                                   href="{% url 'shop:shop_single_product_detail' product.id %}">{{ product.title }}</a></h4>
                                            <div class="price-box">
                                                <span class="new-price">${{ product.price }}</span>
                                            </div>
                                        </div>
                                        <div class="add-actions">
                                            <ul class="add-actions-link">
<li class="add-cart active" >
    <a href="#" class="add-to-cart" data-product-id="{{ product.id }}  " onclick="setTimeout(() => { window.location.reload(); }, 500);">
        Add to cart
    </a>
</li>                                                <li class="wishlist">
                                                    <a href="#" class="add-wishlist" data-product-id="{{ product.id }}">
                                                        <i class="fa fa-heart-o"></i>
                                                    </a>
                                                </li>
                                                <li><a href="#" title="quick view" class="quick-view-btn"
                                                       data-toggle="modal" data-target="#exampleModalCenter"><i
                                                        class="fa fa-eye"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <!-- single-product-wrap end -->
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- Li's Section Area End Here -->
            </div>
        </div>
    </section>
    <!-- Li's Laptop Product Area End Here -->
    <!-- Begin Li's TV & Audio Product Area -->
    <section class="product-area li-laptop-product li-tv-audio-product pb-45">
        <div class="container">
            <div class="row">
                <!-- Begin Li's Section Area -->
                <div class="col-lg-12">
                    <div class="li-section-title">
                        <h2>
                            <span>TV & Audio</span>
                        </h2>
                    </div>
                    <div class="row">
                        <div class="product-active owl-carousel">
                            {% for product in tv_audios %}
                            <div class="col-lg-12">
                                <!-- single-product-wrap start -->
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="{% url 'shop:shop_single_product_detail' product.id %}">
                                            <img src="{{ product.images.first.image.url }}"
                                                 alt="Li's Product Image">
                                        </a>
                                        <span class="sticker">New</span>
                                    </div>
                                    <div class="product_desc">
                                        <div class="product_desc_info">
                                            <div class="product-review">
                                                <h5 class="manufacturer">
                                                    <a href="{% url 'shop:shop' %}">Graphic Corner</a>
                                                </h5>
                                                <div class="rating-box">
                                                    <ul class="rating">
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <h4><a class="product_name"
                                                   href="{% url 'shop:shop_single_product_detail' product.id %}">{{ product.title }}</a></h4>
                                            <div class="price-box">
                                                <span class="new-price">${{ product.price }}</span>
                                            </div>
                                        </div>
                                        <div class="add-actions">
                                            <ul class="add-actions-link">
<li class="add-cart active" >
    <a href="#" class="add-to-cart" data-product-id="{{ product.id }}  " onclick="setTimeout(() => { window.location.reload(); }, 500);">
        Add to cart
    </a>
</li>                                                <li class="wishlist">
                                                    <a href="#" class="add-wishlist" data-product-id="{{ product.id }}">
                                                        <i class="fa fa-heart-o"></i>
                                                    </a>
                                                </li>
                                                <li><a href="#" title="quick view" class="quick-view-btn"
                                                       data-toggle="modal" data-target="#exampleModalCenter"><i
                                                        class="fa fa-eye"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <!-- single-product-wrap end -->
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- Li's Section Area End Here -->
            </div>
        </div>
    </section>
    <!-- Li's TV & Audio Product Area End Here -->
    <!-- Begin Li's Static Home Area -->
    <div class="li-static-home">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <!-- Begin Li's Static Home Image Area -->
                    <div class="li-static-home-image"></div>
                    <!-- Li's Static Home Image Area End Here -->
                    <!-- Begin Li's Static Home Content Area -->
                    <div class="li-static-home-content">
                        <p>Sale Offer<span>-20% Off</span>This Week</p>
                        <h2>Featured Product</h2>
                        <h2>Meito Accessories 2018</h2>
                        <p class="schedule">
                            Starting at
                            <span> $1209.00</span>
                        </p>
                        <div class="default-btn">
                            <a href="{% url 'shop:shop' %}" class="links">Shopping Now</a>
                        </div>
                    </div>
                    <!-- Li's Static Home Content Area End Here -->
                </div>
            </div>
        </div>
    </div>
    <!-- Li's Static Home Area End Here -->
    <!-- Begin Li's Trending Product Area -->
    <section class="product-area li-trending-product pt-60 pb-45">
        <div class="container">
            <div class="row">
                <!-- Begin Li's Tab Menu Area -->
                <div class="col-lg-12">
                    <div class="li-product-tab li-trending-product-tab">
                        <h2>
                            <span>Phones</span>
                        </h2>
                        <ul class="nav li-product-menu li-trending-product-menu">
                            
                        </ul>
                    </div>
                    <!-- Begin Li's Tab Menu Content Area -->
                    <div class="tab-content li-tab-content li-trending-product-content">
                        <div class="tab-pane show fade in active">
                            <div class="row">
                                <div class="product-active owl-carousel">
                                    {% for product in phones %}
                                    <div class="col-lg-12">
                                        <!-- single-product-wrap start -->
                                        <div class="single-product-wrap">
                                            <div class="product-image">
                                                <a href="{% url 'shop:shop_single_product_detail' product.id %}">
                                                    <img src="{{ product.images.first.image.url }}"
                                                         alt="Li's Product Image">
                                                </a>
                                                <span class="sticker">New</span>
                                            </div>
                                            <div class="product_desc">
                                                <div class="product_desc_info">
                                                    <div class="product-review">
                                                        <h5 class="manufacturer">
                                                            <a href="{% url 'shop:shop' %}">Graphic Corner</a>
                                                        </h5>
                                                        <div class="rating-box">
                                                            <ul class="rating">
                                                                <li><i class="fa fa-star-o"></i></li>
                                                                <li><i class="fa fa-star-o"></i></li>
                                                                <li><i class="fa fa-star-o"></i></li>
                                                                <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                                <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <h4><a class="product_name"
                                                           href="{% url 'shop:shop_single_product_detail' product.id %}">{{ product.title}}</a></h4>
                                                    <div class="price-box">
                                                        <span class="new-price">${{ product.price }}</span>
                                                    </div>
                                                </div>
                                                <div class="add-actions">
                                                    <ul class="add-actions-link">
                                                        <li class="add-cart active" >
                                                    <a href="#" class="add-to-cart" data-product-id="{{ product.id }}  " onclick="setTimeout(() => { window.location.reload(); }, 500);">
                                                Add to cart
                                                    </a>
                                                        </li>
                                                        <li class="wishlist">
                                                            <a href="#" class="add-wishlist"
                                                               data-product-id="{{ product.id }}">
                                                                <i class="fa fa-heart-o"></i>
                                                            </a>
                                                        </li>
                                                        <li><a href="#" title="quick view" class="quick-view-btn"
                                                               data-toggle="modal" data-target="#exampleModalCenter"><i
                                                                class="fa fa-eye"></i></a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- single-product-wrap end -->
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Tab Menu Content Area End Here -->
                </div>
                <!-- Tab Menu Area End Here -->
            </div>
        </div>
    </section>
{#    <!-- Li's Trending Product Area End Here -->#}
{#    <!-- Begin Li's Trendding Products Area -->#}

    <section class="product-area li-laptop-product li-trendding-products best-sellers pb-45">
        <div class="container">
            <div class="row">
                <!-- Begin Li's Section Area -->
                <div class="col-lg-12">
                    <div class="li-section-title">
                        <h2>
                            <span>New added Products</span>
                        </h2>
                    </div>
                    <div class="row">
                        <div class="product-active owl-carousel">
                            {% for product in new_arrivals %}
                            <div class="col-lg-12">
                                <!-- single-product-wrap start -->
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="{% url 'shop:shop_single_product_detail' product.id %}">
                                            <img src="{{ product.images.first.image.url }}"
                                                 alt="Li's Product Image">
                                        </a>
                                        <span class="sticker">New</span>
                                    </div>
                                    <div class="product_desc">
                                        <div class="product_desc_info">
                                            <div class="product-review">
                                                <h5 class="manufacturer">
                                                    <a href="{% url 'shop:shop' %}">Graphic Corner</a>
                                                </h5>
                                                <div class="rating-box">
                                                    <ul class="rating">
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                        <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <h4><a class="product_name"
                                                   href="{% url 'shop:shop_single_product_detail' product.id %}">{{ product.title }}</a></h4>
                                            <div class="price-box">
                                                <span class="new-price">${{ product.price }}</span>
                                            </div>
                                        </div>
                                        <div class="add-actions">
                                            <ul class="add-actions-link">
                                                <li class="add-cart active" >
                                                    <a href="#" class="add-to-cart" data-product-id="{{ product.id }}  " onclick="setTimeout(() => { window.location.reload(); }, 500);">
                                                        Add to cart
                                                    </a>
                                                        </li>

                                                    <li class="wishlist">
                                                      <a href="#" class="add-wishlist" data-product-id="{{ product.id }}">
                                                        <i class="fa fa-heart-o"></i>
                                                        </a>
                                                 </li>
                                                 <li><a href="#" title="quick view" class="quick-view-btn"
                                                       data-toggle="modal" data-target="#exampleModalCenter"><i
                                                        class="fa fa-eye"></i></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                <!-- single-product-wrap end -->
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- Li's Section Area End Here -->
            </div>
        </div>
    </section>

    <script>
document.addEventListener("DOMContentLoaded", function () {
    const productContainer = document.getElementById('product-container');
    const filterCheckboxes = document.querySelectorAll('.filter-checkbox');
    const sortSelect = document.getElementById('sort-select');
    const clearAllBtn = document.querySelector('.btn-clear-all');
    let currentPage = 1;

    function updateProducts() {
        const queryParams = new URLSearchParams();

        filterCheckboxes.forEach(checkbox => {
            if (checkbox.checked) {
                queryParams.append(checkbox.dataset.filterType, checkbox.value);
            }
        });

        if (sortSelect) {
            queryParams.set('sort', sortSelect.value);
        }

        queryParams.set('page', currentPage);
        window.history.pushState({}, '', `${window.location.pathname}?${queryParams.toString()}`);

        fetch(`/shop/?${queryParams.toString()}`, {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.text())
        .then(html => {
            productContainer.innerHTML = html;
            setupEventListeners();
        })
        .catch(error => console.error('Xatolik yuz berdi:', error));
    }

    function setupExclusiveSelection(filterType) {
        document.querySelectorAll(`input[data-filter-type="${filterType}"]`).forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                document.querySelectorAll(`input[data-filter-type="${filterType}"]`).forEach(otherCheckbox => {
                    if (otherCheckbox !== checkbox) {
                        otherCheckbox.checked = false;
                    }
                });
                updateProducts();
            });
        });
    }

    ["category", "size", "color", "dimension"].forEach(setupExclusiveSelection);

    if (sortSelect) {
        sortSelect.addEventListener('change', function () {
            currentPage = 1;
            updateProducts();
        });
    }

    if (clearAllBtn) {
        clearAllBtn.addEventListener('click', function () {
            filterCheckboxes.forEach(checkbox => checkbox.checked = false);
            if (sortSelect) {
                sortSelect.value = "relevance";
            }
            updateProducts();
        });
    }

    function initializeFiltersFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        filterCheckboxes.forEach(checkbox => {
            if (urlParams.has(checkbox.dataset.filterType)) {
                const values = urlParams.getAll(checkbox.dataset.filterType);
                if (values.includes(checkbox.value)) {
                    checkbox.checked = true;
                }
            }
        });

        if (urlParams.has('sort') && sortSelect) {
            sortSelect.value = urlParams.get('sort');
        }
    }

    function setupEventListeners() {
        document.querySelectorAll(".add-wishlist").forEach(button => {
            button.removeEventListener("click", wishlistHandler);
            button.addEventListener("click", wishlistHandler);
        });

        document.querySelectorAll(".add-to-cart").forEach(button => {
            button.removeEventListener("click", addToCartHandler);
            button.addEventListener("click", addToCartHandler);
        });

        document.querySelectorAll(".remove-from-cart").forEach(button => {
            button.removeEventListener("click", removeFromCartHandler);
            button.addEventListener("click", removeFromCartHandler);
        });
    }

    function wishlistHandler(event) {
        event.preventDefault();

        let productId = this.getAttribute("data-product-id");
        let icon = this.querySelector("i");
        let url = "{% url 'shop:add_wishlist' %}";
        let csrftoken = document.querySelector("[name=csrfmiddlewaretoken]").value;

        fetch(url, {
            method: "POST",
            headers: {
                "X-CSRFToken": csrftoken,
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `product_id=${productId}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.wishlist_count !== undefined) {
                document.getElementById("wishlist-count").innerText = data.wishlist_count;
            }

            if (data.added) {
                icon.classList.remove("fa-heart-o");
                icon.classList.add("fa-heart");
                icon.style.color = "black";
            } else {
                icon.classList.remove("fa-heart");
                icon.classList.add("fa-heart-o");
                icon.style.color = "";
            }
        })
        .catch(error => console.error("AJAX Error:", error));
    }

    function addToCartHandler(event) {
        event.preventDefault();

        let productId = this.getAttribute("data-product-id");
        let icon = this.querySelector("i");

        fetch("{% url 'shop:add_to_cart' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `product_id=${productId}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.cart_items !== undefined) {
                document.getElementById("cart-count").innerText = data.cart_items;
            }

            if (data.added) {
                icon.classList.remove("fa-shopping-cart");
                icon.classList.add("fa-check");
                icon.style.color = "black";
            } else {
                icon.classList.remove("fa-check");
                icon.classList.add("fa-shopping-cart");
                icon.style.color = "";
            }
        })
        .catch(error => console.error("AJAX Error:", error));
    }

    function removeFromCartHandler(event) {
        event.preventDefault();

        let productId = this.getAttribute("data-product-id");

        fetch("{% url 'shop:remove_from_cart' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `product_id=${productId}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.cart_count !== undefined) {
                document.getElementById("cart-count").innerText = data.cart_count;
            }

            this.closest("li").remove();
        })
        .catch(error => console.error("AJAX Error:", error));
    }

    initializeFiltersFromURL();
    updateProducts();
    setupEventListeners();
});
</script>
    <!-- Li's Trendding Products Area End Here -->
    <!-- Begin Footer Area -->
{% endblock content %}
